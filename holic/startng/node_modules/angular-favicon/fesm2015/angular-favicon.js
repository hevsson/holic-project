import { Injectable, Inject, defineInjectable, inject } from '@angular/core';
import { DOCUMENT } from '@angular/common';
import { ɵgetDOM } from '@angular/platform-browser';
import { fromEventPattern } from 'rxjs';
import { pluck } from 'rxjs/operators';

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
/**
 * A service to set the favicon.
 */
class AngularFaviconService {
    /**
     * @param {?} _doc
     */
    constructor(_doc) {
        this._doc = _doc;
        this.darkScheme = '(prefers-color-scheme:dark)';
        this.prefersColorScheme$ = fromEventPattern((/**
         * @param {?} handler
         * @return {?}
         */
        handler => window.matchMedia(this.darkScheme).addListener((/** @type {?} */ (handler))))).pipe(pluck('matches'));
    }
    /**
     * Get the favicon of the current HTML document.
     * @return {?}
     */
    getFavicon() {
        return ɵgetDOM().querySelector(this._doc, "link[rel*='icon']");
    }
    /**
     * Set the title of the current HTML document.
     * @param {?} iconURL - Default favicon URL
     * @param {?=} altIconURL - Optional, dark theme favicon URL
     * @return {?}
     */
    setFavicon(iconURL, altIconURL) {
        /** @type {?} */
        const link = this.getFavicon() || ɵgetDOM().createElement('link');
        /** @type {?} */
        let currentLinkHref = iconURL;
        if (altIconURL) {
            this.subscribeToChangesInTheme(link, iconURL, altIconURL);
            if (window.matchMedia(this.darkScheme).matches) {
                currentLinkHref = altIconURL;
            }
        }
        this.appendLinkTag(link, currentLinkHref);
    }
    /**
     * Subscribe to the theme color changes in browser/OS and apply the appropiate favicon
     * @private
     * @param {?} link - DOM element
     * @param {?} iconURL - Default favicon URL
     * @param {?} altIconURL - Optional, dark theme favicon URL
     * @return {?}
     */
    subscribeToChangesInTheme(link, iconURL, altIconURL) {
        this.subscriptionToColorScheme = this.prefersColorScheme$.subscribe((/**
         * @param {?} isDarkTheme
         * @return {?}
         */
        isDarkTheme => {
            if (isDarkTheme) {
                this.appendLinkTag(link, altIconURL);
            }
            else {
                this.appendLinkTag(link, iconURL);
            }
        }));
    }
    /**
     * Append new link to HEAD
     * @private
     * @param {?} link - DOM element
     * @param {?} iconURL - favicon URL
     * @return {?}
     */
    appendLinkTag(link, iconURL) {
        link.type = 'image/x-icon';
        link.rel = 'shortcut icon';
        link.href = iconURL;
        ɵgetDOM()
            .getElementsByTagName(this._doc, 'head')[0]
            .appendChild(link);
    }
    /**
     * @return {?}
     */
    ngOnDestroy() {
        this.subscriptionToColorScheme.unsubscribe();
    }
}
AngularFaviconService.decorators = [
    { type: Injectable, args: [{
                providedIn: 'root'
            },] }
];
/** @nocollapse */
AngularFaviconService.ctorParameters = () => [
    { type: undefined, decorators: [{ type: Inject, args: [DOCUMENT,] }] }
];
/** @nocollapse */ AngularFaviconService.ngInjectableDef = defineInjectable({ factory: function AngularFaviconService_Factory() { return new AngularFaviconService(inject(DOCUMENT)); }, token: AngularFaviconService, providedIn: "root" });

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */

/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */

export { AngularFaviconService };

//# sourceMappingURL=angular-favicon.js.map